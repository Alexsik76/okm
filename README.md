# okm
## Основи комп'ютерних мереж

### Демонстрація роботи мереж в середовищі Docker.

#### Котроткий опис:

Створюються 3 контейнери, які використовують одну мережу. В контейнери на базі Ubuntu встановлюються пакунки для команди ```ping```.
Третій контейнер з образом ```Nginx``` запускає вебсервер та відображає сторінку ```index.html``` з папки ```html```, яка монтується у контейнер.

#### Значення основних команд:

##### Dockerfile:
- ```FROM ubuntu:latest``` - який образ використовуєтся для створення контейнера:
https://hub.docker.com/_/ubuntu/ ;
- ```RUN apt update && apt install -y inetutils-ping``` - запустити оновлення інформації про пакунки після чого встановити пакунок. (ключ ```-y``` означає мовчазну згоду на встановлення);


##### docker-compose.yml:
У файлі мають значення відступи. То ж ```services:``` відкриває секцію опису сервісів. Їх 3 (cont1, cont2, web). ```build: .``` означає, що для створення контейнера буде використано ```Dockerfile```, який знаходиться у цій же директорії (Крапка через пробіл означає саме розташуваня у поточній директорії).
Якщо для контейнера достатньо налаштувань базового образу, тоді використовується команда ```image: <назва образу>```.
Перші два контейнери не передбачені бути доступними ззовні мережі. Натомість у третьому ми хотіли б мати доступ до сервісу, який доступний на порту 80. Тому потрібно "відкрити" цей порт назовні. Для цього слугує команда ``` ports:
    - "80:80"```.

Отже, третій контейнер запускає вебсервер ```nginx```, який може ослуговувати HTTP запити. У даному випадку він просто повертає у відповідь на ці запити просту HTML сторінку.

### Запуск контейнерів: 

Запуск здійснюється за допомогою команди ```docker compose up -d``` де 

- ```docker``` звернення до сервісу Докер;
- ```compose``` виклик утиліти управління групами контейнерів;
- ```up``` команда запуску (підняття) групи контейнерів;
- ```-d``` запуск в режимі демона (командний рядок звільниться, стане можливим виконання інших команд, але контейнери продовжать свою роботу в фоновому "демонічному" режимі).

Слід відзначити, що передумовами виконання команди у такому форматі є
- запуск її у директорії розміщення файлу ```docker-compose.yml``` або ```docker-compose.yaml```;
- ім'я файлу має бути саме ```docker-compose.yml``` або ```docker-compose.yaml```;


<details><summary>Приклад запуску з нестандартним іменем файлу</summary><p>

> У цьому випадку потрібно використовувати параметр ```-f``` 
після якого вказувати ім'я конфігураційного файлу або його 
місце розташування.
>
> ```docker compose -f my-compose.yml up -d```

</p></details>

### Перевірка контейнерів: 

Щоб переконатись що контейнери запущені необхідно виконати команду ```docker ps```
<details><summary>Детальніше:</summary><p>

> Насправді це синонім (alias) для команди ```docker container ls```
>
> Повну довідку про параметри запуску можна отримати ```docker ps --help``` або за посиланням [https://docs.docker.com](https://docs.docker.com/reference/cli/docker/container/ls/)

</p></details>

Якщо усе гаразд, відобразиться щось на зразок:

```
CONTAINER ID   IMAGE       COMMAND                  CREATED       STATUS          PORTS                NAMES
b33577ae1891   nginx       "/docker-entrypoint.…"   13 days ago   Up 10 seconds   0.0.0.0:80->80/tcp   okm-web-1
17696030c5a4   okm-cont2   "/bin/bash"              13 days ago   Up 10 seconds                        okm-cont2-1
2d5367096a48   okm-cont1   "/bin/bash"              13 days ago   Up 10 seconds                        okm-cont1-1
```

Слід звернути увагу на стовпець таблиці ```STATUS```.

Якщо запуск контейнерів не був успішним, команда не відобразить їх. У такому випадку необхідно додати ключ ```docker ps -a``` тому що згідно документації ```-a, --all		Show all containers (default shows just running)```

### Вхід до середовища контейнера:

Для перевірки роботи перших двох контейнерів потрібно входити до їх середовища, тобто виконувати команди всередині певного контейнера. 
Для цього слугує команда ```docker exec```. У нашому випадку повна команда виглядатиме як ```docker exec -it okm-cont1-1 bash```.

<details><summary>Докладніше</summary><p>

> The ```docker exec``` command runs a new command in a running container.
>
> Найчастіше використовується з ключами 
>- -i, --interactive		Keep STDIN open even if not attached;
>- -t, --tty		Allocate a pseudo-TTY
>
> обов'язковими параметрами є ім'я контейнера, та сама команда, яку слід виконати.
> 
> У нашому випадку команда матиме вигляд: ```docker exec -it okm-cont1-1 bash```. Стосовно останньої частини ```bash``` слід пояснити, що це і є команда, яку ми будемо виконувати. bash - командна оболонка середовища Linux. Часто можна зустріти варіанти ```/bin/bash```, ```sh```, ```/bin/sh```. Справа у тому, що bash це "Bourne again shell" - оновлена інтерпретація командної оболонки ```sh```. У зв'язку з цим просто ```sh``` доступна абсолютно у всіх образах на базі Linux, з ```bash``` це може бути не так. Але ```bash``` має ряд переваг. Тому, якщо доступний ```bash``` - зручніше використовувати його. Зокрема, саме завдяки ```bash``` можливо корегувати набрану команду, повертатись до попередніх команд і т.п. Варіант ```/bin/bash``` більш універсальний, так як містить повний шлях до програми і спрацює навіть тоді, якщо в системі не налаштовано змінну оточення ```PATH```.  

</p></details>

У разі успіху можна побачити зміну вигляду рядка запрошення на щось схоже ```root@2d5367096a48:/# ```. Це означає ми в середовищі командної оболонки контейнера.
Для повернення у командний рядок хоста можна скористатись комбінацією клавіш ```Ctrl+D``` або командою ```exit```.

### Виконання команд ping:

В командній оболонці контейнера можливо виконувати команду ```ping```, яка призначена для перевірки доступності ресурсу мережі. Мінімальний синтаксис: ```ping <назва хосту або адреса>```. Тобто, за умови працюючого DNS, ```ping 172.21.0.2``` та ```ping okm-web-1``` рівнозначні.<details><summary>(значення адреси може відрізнятись.)</summary><p> 
> Побачити фактичну адресу контейнера можливо командою ```docker inspect <Id або ім'я контейнера>``` у нашому випадку  ``` docker inspect okm-web-1``` в розділі ```NetworkSettings -> Networks -> IPAddress``` .
</p></details>
<details><summary>Для зручності</summary><p>

> У наведеному прикладі команда ```ping okm-web-1``` виконуватиметься нескінченно. Щоб припинити її виконання можна скористатись комбінацією ```Ctrl+C```. Інший спосіб - додати до команди ключ ```-c``` із зазначенням кількості повторів. Тобто ```ping okm-web-1 -c 4``` виконає лише 4 запити і зупиниться. 
</p>
</details>
Результати виконання команди містяться у відповідному рядку: 

```
---okm-web-1 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
```


